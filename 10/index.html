<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>1Heaven</title>

<style>
@import url("https://use.typekit.net/zuk4pzv.css");

* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family:"minion-pro", serif;
  background:#fff;
}

a { color:inherit; text-decoration:none; }

/* ===== footer ===== */
.footer{
  position:fixed;
  bottom:0; left:0;
  width:100%;
  height:100px;
  z-index:1000;
  color:#a3a3a3;
  pointer-events:none;
}
.footer *{ pointer-events:auto; }
.footer .right-link,
.footer #listButton{
  position:absolute;
  bottom:10px;
  font-size:12px;
}
.footer .right-link{ left:30px; }
.footer #listButton{ right:30px; cursor:pointer; }

/* ===== layout (PC 유지) ===== */
@media (min-width:769px){
  html,body{ width:100%; height:100%; overflow:hidden; }
  .gallery-wrap{
    display:grid;
    grid-template-columns:57.78% 17.55% 24.68%;
    height:100%;
  }
}

::-webkit-scrollbar{ display:none; }

/* ===== fixed image (PC: 슬라이드 / Mobile: 스크롤) ===== */
.fixed-image{
  position:relative;
  width:100%;
  height:100%;
  border-left:1px solid #9fa0a0;
  border-right:1px solid #9fa0a0;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
}

/* 모바일일 때만 스크롤 방식으로 변경 */
@media (max-width:768px) {
  .fixed-image {
    display: block; /* 세로 나열 */
    overflow-y: auto;
    height: auto;
    border: none;
  }
}

.fixed-image img{
  max-width:90%;
  max-height:90%;
  object-fit:contain;
}

@media (max-width:768px) {
  .fixed-image img {
    width: 100%;
    max-width: none;
    max-height: none;
    display: block;
  }
}

.nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:40px;
  cursor:pointer;
  user-select:none;
  z-index: 10;
}
.nav.prev{ left:20px; }
.nav.next{ right:20px; }

/* ===== thumbnails (PC 전용) ===== */
.scroll-area{
  height:100%;
  overflow-y:auto;
  border-right:1px solid #9fa0a0;
}
.content{
  display:grid;
  grid-template-columns:repeat(2,1fr);
}
.thumbnail img{ width:100%; display:block; }
.caption{
  font-size:12px;
  margin-top:6px;
  margin-bottom:6px;
}

/* ===== caption info ===== */
.slide-box{
  height:100%;
  padding:20px;
  overflow-y:auto;
}
.caption1{ font-size:20px; margin-bottom:3px; }
.caption2,.caption3,.caption4,.caption5{
  font-size:12px;
  margin-bottom:3px;
}

/* ===== mobile 전용 스타일 ===== */
@media (max-width:768px){
  .gallery-wrap{ display:block; }
  .nav{ display:none; } /* 모바일에서 화살표 숨김 */
  .scroll-area{ display:none; } /* 모바일에서 썸네일 영역 숨김 */

  .slide-box{
    position:fixed;
    top:0; right:0;
    width:100%;
    height:100%;
    background:#fff;
    transform:translateX(100%);
    transition:.3s;
    z-index:3000;
  }
  .slide-box.active{ transform:translateX(0); }
}
</style>
</head>

<body>

<div class="gallery-wrap">

  <div class="fixed-image" id="fixedImage">
    <div class="nav prev" id="prevBtn">‹</div>
    <img id="mainImage">
    <div id="mobileImageContainer"></div>
    <div class="nav next" id="nextBtn">›</div>
  </div>

  <div class="scroll-area">
    <div class="content" id="gallery"></div>
  </div>

  <div class="slide-box" id="slideBox">
    <div id="captionBox"></div>
  </div>

</div>

<div class="footer">
  <div class="right-link"><a href="/mika/">back</a></div>
  <div id="listButton" onclick="toggleSlideBox()">info</div>
</div>

<script>
let images=[], index=0;

async function loadData(){
  const res=await fetch("../data.json");
  const data=await res.json();
  
  // URL에서 인덱스 추출
  const pathParts = window.location.pathname.split("/");
  const idxStr = pathParts.filter(p => p !== "").pop();
  const idx = parseInt(idxStr, 10) - 1;
  
  const item=data[idx];
  if(!item) return;

  images=item.images;
  const mainImg = document.getElementById("mainImage");
  const mobileContainer = document.getElementById("mobileImageContainer");

  // 화면 크기에 따른 초기 셋팅
  if(window.innerWidth <= 768){
    // 모바일: 모든 이미지를 나열
    mainImg.style.display = "none";
    mobileContainer.innerHTML = "";
    images.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      mobileContainer.appendChild(img);
    });
  } else {
    // PC: 슬라이드 방식 유지
    mainImg.style.display = "block";
    mobileContainer.innerHTML = "";
    updateImage();
  }

  // 썸네일 갤러리 생성 (PC용)
  const g = document.getElementById("gallery");
  g.innerHTML = "";
  data.slice().reverse().forEach((d, i) => {
    const realIdx = data.length - 1 - i;
    g.innerHTML += `
      <a href="/mika/${realIdx + 1}/" class="thumbnail">
        <img src="/mika/images/thumb${realIdx + 1}.png">
        <div class="caption">${d.title}<br>${d.category} ${d.year}</div>
      </a>`;
  });

  // 캡션 정보 업데이트
  document.getElementById("captionBox").innerHTML = `
    <div class="caption1">${item.captions.caption1}</div>
    <div class="caption2">${item.captions.caption2}</div>
    <div class="caption3">${item.captions.caption3}</div>
    <div class="caption4">${item.captions.caption4}</div>
    <div class="caption5">${item.captions.caption5}</div>`;
}

function updateImage(){
  const mainImg = document.getElementById("mainImage");
  if(mainImg && images[index]) {
    mainImg.src = images[index];
  }
}

// PC용 슬라이드 버튼
document.getElementById("prevBtn").onclick = () => { 
  if(index > 0){ index--; updateImage(); } 
}
document.getElementById("nextBtn").onclick = () => { 
  if(index < images.length - 1){ index++; updateImage(); } 
}

function toggleSlideBox(){
  if(window.innerWidth <= 768){
    document.getElementById("slideBox").classList.toggle("active");
    const btn = document.getElementById("listButton");
    btn.textContent = document.getElementById("slideBox").classList.contains("active") ? "close" : "info";
  }
}

// 창 크기가 바뀔 때 대응 (선택 사항)
window.onresize = () => {
  if(window.innerWidth > 768) {
    document.getElementById("mainImage").style.display = "block";
    document.getElementById("mobileImageContainer").innerHTML = "";
    updateImage();
  } else {
    loadData(); // 모바일 모드로 재로드
  }
};

document.addEventListener("DOMContentLoaded", loadData);
</script>

</body>
</html>
